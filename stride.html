<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>STRIDE → CWE Mapping (EMB3D)</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f8f9fa;
    }
    h1 { color: #222; }
    select, button {
      padding: 8px;
      font-size: 1rem;
      margin-right: 8px;
    }
    .card {
      background: #fff;
      padding: 1rem;
      margin: 1rem 0;
      border-left: 5px solid #0078d4;
      box-shadow: 0 2px 4px rgba(0,0,0,.1);
    }
  </style>
</head>

<body>

<h1>STRIDE → CWE Mapping</h1>

  <!-- ✅ 1️⃣ Chargement des données AVANT toute logique -->
<script src="./data/data.js"></script>

<select id="strideSelect">
  <option value="">-- Choisir un STRIDE --</option>
  <option value="Spoofing">Spoofing</option>
  <option value="Tampering">Tampering</option>
  <option value="Repudiation">Repudiation</option>
  <option value="Information Disclosure">Information Disclosure</option>
  <option value="Denial of Service">Denial of Service</option>
  <option value="Elevation of Privilege">Elevation of Privilege</option>
</select>

<button id="searchBtn">Afficher</button>

<div id="results"></div>



<!-- ✅ 2️⃣ Logique applicative -->
<script>
document.getElementById("searchBtn").addEventListener("click", searchByStride);

function searchByStride() {
  if (typeof CWE_DATA === "undefined") {
    alert("Erreur : données CWE non chargées (CWE_DATA undefined)");
    return;
  }

  const selectedStride = document.getElementById("strideSelect").value;
  const results = document.getElementById("results");
  results.innerHTML = "";

  if (!selectedStride) {
    results.innerHTML = "<p>Veuillez sélectionner un STRIDE.</p>";
    return;
  }

  const matchingCWEs = Object.entries(CWE_DATA)
    .filter(([_, data]) => data.stride.includes(selectedStride));

  if (matchingCWEs.length === 0) {
    results.innerHTML = "<p>Aucune CWE trouvée.</p>";
    return;
  }

  const list = matchingCWEs.map(([cwe, data]) => `
    <li>
      <strong>${cwe}</strong> —
      <a href="${data.lien}" target="_blank">MITRE</a>
    </li>
  `).join("");

  results.innerHTML = `
    <div class="card">
      <h3>${selectedStride}</h3>
      <ul>${list}</ul>
    </div>
  `;
}
</script>

</body>
</html>
